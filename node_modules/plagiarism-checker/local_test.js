
var CopyleaksCloud = require('./src/Components/CopyleaksCloud.js');
var _ = require('lodash');

var clCloud = new CopyleaksCloud();
var config = clCloud.getConfig();

var email = 'cs16mtech11013@iith.ac.in';
var apikey = '44AABBCB-D77D-4F34-AEC1-2E70FBAFA719';

/*TEST SERVER*/
var http = require("http");
var server = http.createServer();
server.listen(8005,'127.0.0.1',function(){
	/* 
		LOGIN ACCEPTS 1 PARAMETER (type of product).
		
		ACCEPTED TYPES: 
		1. publisher 
		2. academy
		
		CONFIG HAS CONSTANTS FOR ACCEPTED TYPES:
		1. config.E_PRODUCT.PUBLISHER
		2. config.E_PRODUCT.ACADEMY
		
	*/
	clCloud.login(email,apikey,config.E_PRODUCT.PUBLISHER,callback);
	
	function callback(resp,err){

	    //CHECK CREDIT BALANCE FOR YOUR ACCOUNT
	    /* 
	    clCloud.getCreditBalance(function(resp,err){
	    	//check if we have credits
	    	if(resp && resp.Amount){
	    		console.log('You have this amount of credits left: '+resp.Amount);
	    	}
	    });
		*/

		/*
		Check if token still valid:

		clCloud.loginToken.validateToken() //return true \ false
		*/
		

	    var _customHeaders = {};
	    _customHeaders[config.SANDBOX_MODE_HEADER] = true;
		//_customHeaders[config.HTTP_CALLBACK] = 'http://example.com/callback-path';
		// See more custom-options @ https://api.copyleaks.com/Documentation/RequestHeaders
		
		//create-by-url
	    var url = 'https://www.copyleaks.com'; // URL to scan
	    clCloud.createByURL(url,_customHeaders,function(resp,err){

	    	//check if we have credits
	    	if(resp && resp.ProcessId){
	    		console.log('API: create-by-url');
	    		console.log('Process has been created: '+resp.ProcessId);
	    	}
	    });
		
	    //create-by-file example
	    /*
	    var _file = __dirname+'/tests/1.pdf';
	    clCloud.createByFile(_file,_customHeaders,function(resp,err){

	    	//check if we have credits
	    	if(resp && resp.ProcessId){
	    		console.log('API: create-by-file');
	    		console.log('Process has been created: '+resp.ProcessId);
	    	}
	    });
		*/

	    //create-by-file-ocr example
	    /*
	    var language = 'English';
	    var _ocrFile = __dirname+'/tests/2000px-PDCA_Cycle.svg.png';
	    clCloud.createByFileOCR(_ocrFile,_customHeaders,language,function(resp,err){
			
	    	//check if we have credits
	    	if(resp && resp.ProcessId){
	    		console.log('API: create-by-file-ocr');
	    		console.log('Process has been created: '+resp.ProcessId);
	    	}
	    });
		*/

		//create-by-text
		/*
	    clCloud.createByText('<PUT YOUR TEXT HERE>',_customHeaders,function(resp,err){

	    	//check if we have credits
	    	if(resp && resp.ProcessId){
	    		console.log('API: create-by-text');
	    		console.log('Process has been created: '+resp.ProcessId);
	    	}
	    });
		*/

	    //get processes list api
	    clCloud.getProcessList(function(resp,err){
	    	
	    	//check if we have credits
	    	if(resp && resp.length > 0){
	    		console.log('API: processes list');
	    		console.log('There are '+resp.length+' processes running:');
	    		_.forIn(resp,function(pval,pk){
	    			console.log(pval.ProcessId);
	    		});
	    	}
	    });


	    //example for process getStatus,getResults & delete
	    //var _pid = '<YOUR_PID_HERE>';

	    /* Get process status exmaple */
	    //clCloud.getProcessStatus(_pid,function(resp,err){
	    //	console.log(resp);
	    //});

	    /* Get process results example */
	    //clCloud.getProcessResults(_pid,function(resp,err){
	    //	console.log(resp);
	    //});

	    /* Delete process example */
	    //clCloud.deleteProcess(_pid,function(resp,err){
	    //	console.log(resp);
	    //});
	}

	server.close();
});

process.on("exit", function() {
  console.log('Closed process');
});